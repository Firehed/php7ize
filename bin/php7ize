#!/usr/bin/env php
<?php

// Find autoloader
$found = false;
foreach (['.', '..', '../..'] as $dir) {
  $loc = __DIR__.DIRECTORY_SEPARATOR.
    $dir.DIRECTORY_SEPARATOR.
    'vendor'.DIRECTORY_SEPARATOR.'autoload.php';
  if (file_exists($loc)) {
    $found = true;
    break;
  }
}
if (!$found) {
  fwrite(STDERR, "Composer autoload.php could not be located");
  exit(1);
}
require_once $loc;

$opts = getopt('o:q',
  ['stdout', 'output-file:', 'quiet'])
  + ['o' => null, 'output-file' => null];

$output_file = $opts['o'] ?: $opts['output-file'];
$to_stdout = isset($opts['stdout']);
$is_quiet = isset($opts['quiet']) || isset($opts['q']);

(new Firehed\PHP7ize\Converter())
  ->setSource(end($argv))
  ->setOutputFile($output_file)
  ->setEcho($to_stdout)
  ->setIsQuiet($is_quiet)
  ->convert();
